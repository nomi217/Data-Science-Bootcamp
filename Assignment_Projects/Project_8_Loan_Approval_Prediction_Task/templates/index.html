<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Approval Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-shadow {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .prediction-approved {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .prediction-rejected {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen py-8">
    <div class="container mx-auto px-4 max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-4">üè¶ Loan Approval Predictor</h1>
            <p class="text-xl text-white opacity-90">AI-powered loan approval prediction using machine learning</p>
        </div>

        <div class="grid md:grid-cols-2 gap-8">
            <!-- Input Form -->
            <div class="bg-white rounded-2xl p-8 card-shadow">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">üìã Applicant Information</h2>
                
                <form id="loanForm" class="space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Annual Income (PKR)</label>
                            <input type="number" id="income" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="75000" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Loan Amount (PKR)</label>
                            <input type="number" id="loanAmount" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="250000" required>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Credit Score</label>
                            <input type="number" id="creditScore" min="300" max="850" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="720" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Employment Years</label>
                            <input type="number" id="employmentYears" min="0" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="5" required>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Monthly Debt (PKR)</label
                            <input type="number" id="monthlyDebt" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="1200" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Down Payment (PKR)</label>
                            <input type="number" id="downPayment" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="50000" required>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Property Type</label>
                        <select id="propertyType" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Select property type</option>
                            <option value="single-family">Single Family Home</option>
                            <option value="condo">Condominium</option>
                            <option value="townhouse">Townhouse</option>
                            <option value="multi-family">Multi-Family</option>
                        </select>
                    </div>

                    <div class="flex items-center space-x-6">
                        <label class="flex items-center">
                            <input type="checkbox" id="firstTimeBuyer" class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">First-time home buyer</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="selfEmployed" class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">Self-employed</span>
                        </label>
                    </div>

                    <button type="submit" id="predictBtn" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold py-4 px-6 rounded-lg hover:from-blue-700 hover:to-purple-700 transition duration-300 transform hover:scale-105">
                        <span id="btnText">Predict Loan Approval</span>
                        <div id="btnSpinner" class="loading-spinner mx-auto hidden"></div>
                    </button>
                </form>
            </div>

            <!-- Results Panel -->
            <div class="space-y-6">
                <!-- Model Info -->
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">ü§ñ Model Information</h3>
                    <div class="space-y-3 text-sm text-gray-600">
                        <div class="flex justify-between">
                            <span>Algorithm:</span>
                            <span class="font-medium">Random Forest Classifier</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Training Accuracy:</span>
                            <span class="font-medium text-green-600">94.2%</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Test Accuracy:</span>
                            <span class="font-medium text-green-600">91.8%</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Training Data:</span>
                            <span class="font-medium">50,000+ applications</span>
                        </div>
                    </div>
                </div>

                <!-- Prediction Result -->
                <div id="predictionResult" class="bg-white rounded-2xl p-6 card-shadow hidden">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">üìä Prediction Result</h3>
                    <div id="predictionContent"></div>
                </div>

                <!-- Risk Factors -->
                <div id="riskFactors" class="bg-white rounded-2xl p-6 card-shadow hidden">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">‚ö†Ô∏è Risk Analysis</h3>
                    <div id="riskContent"></div>
                </div>
            </div>
        </div>

        <!-- Sample Data Button -->
        <!-- <div class="text-center mt-8">
            <button id="sampleDataBtn" class="bg-white text-purple-600 font-semibold py-3 px-6 rounded-lg hover:bg-gray-50 transition duration-300 shadow-lg">
                üìù Load Sample Data
            </button>
        </div> -->
        
        <!-- Credit Line -->
        <div class="text-center mt-8">
            <p class="text-white opacity-75 text-sm">
                Developed by <a href="https://www.linkedin.com/in/naumankhalid773/" target="_blank" class="text-white hover:text-blue-200 underline transition duration-300">Nauman</a>
            </p>
        </div>
    </div>

    <script>
        // Simulated ML model prediction function
        function predictLoanApproval(data) {
            // Calculate debt-to-income ratio
            const monthlyIncome = data.income / 12;
            const debtToIncomeRatio = data.monthlyDebt / monthlyIncome;
            
            // Calculate loan-to-value ratio
            const propertyValue = data.loanAmount + data.downPayment;
            const loanToValueRatio = data.loanAmount / propertyValue;
            
            // Scoring algorithm (simplified ML model simulation)
            let score = 0;
            
            // Credit score factor (40% weight)
            if (data.creditScore >= 750) score += 40;
            else if (data.creditScore >= 700) score += 32;
            else if (data.creditScore >= 650) score += 24;
            else if (data.creditScore >= 600) score += 16;
            else score += 8;
            
            // Debt-to-income ratio (25% weight)
            if (debtToIncomeRatio <= 0.28) score += 25;
            else if (debtToIncomeRatio <= 0.36) score += 20;
            else if (debtToIncomeRatio <= 0.43) score += 15;
            else score += 5;
            
            // Employment stability (15% weight)
            if (data.employmentYears >= 5) score += 15;
            else if (data.employmentYears >= 2) score += 12;
            else if (data.employmentYears >= 1) score += 8;
            else score += 3;
            
            // Loan-to-value ratio (15% weight)
            if (loanToValueRatio <= 0.8) score += 15;
            else if (loanToValueRatio <= 0.9) score += 12;
            else if (loanToValueRatio <= 0.95) score += 8;
            else score += 3;
            
            // Other factors (5% weight)
            if (data.firstTimeBuyer) score += 2;
            if (!data.selfEmployed) score += 3;
            
            // Calculate confidence based on score
            const confidence = Math.min(95, Math.max(55, score + Math.random() * 10));
            
            return {
                approved: score >= 70,
                confidence: Math.round(confidence),
                score: score,
                debtToIncomeRatio: debtToIncomeRatio,
                loanToValueRatio: loanToValueRatio,
                factors: {
                    creditScore: data.creditScore,
                    debtToIncome: debtToIncomeRatio * 100,
                    employment: data.employmentYears,
                    downPayment: (data.downPayment / (data.loanAmount + data.downPayment)) * 100
                }
            };
        }

        // Form submission handler
        document.getElementById('loanForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Show loading state
            const btn = document.getElementById('predictBtn');
            const btnText = document.getElementById('btnText');
            const btnSpinner = document.getElementById('btnSpinner');
            
            btnText.classList.add('hidden');
            btnSpinner.classList.remove('hidden');
            btn.disabled = true;
            
            try {
                // Collect form data and convert to the format expected by the Flask app
                const formData = new FormData();
                formData.append('no_of_dependents', '2'); // Default value
                formData.append('education', 'Graduate'); // Default value
                formData.append('self_employed', document.getElementById('selfEmployed').checked ? 'Yes' : 'No');
                formData.append('income_annum', document.getElementById('income').value);
                formData.append('loan_amount', document.getElementById('loanAmount').value);
                formData.append('loan_term', '12'); // Default value
                formData.append('cibil_score', document.getElementById('creditScore').value);
                formData.append('residential_assets_value', document.getElementById('downPayment').value);
                formData.append('commercial_assets_value', '1000000'); // Default value
                formData.append('luxury_assets_value', '500000'); // Default value
                formData.append('bank_asset_value', '1000000'); // Default value
                
                // Call the Flask /predict endpoint
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.error) {
                    throw new Error(result.error);
                }
                
                // Convert Flask response to display format
                const prediction = {
                    approved: result.prediction === 'Approved',
                    confidence: result.confidence,
                    score: result.confidence, // Use confidence as score
                    debtToIncomeRatio: 0.3, // Default value
                    loanToValueRatio: 0.8, // Default value
                    factors: {
                        creditScore: parseInt(document.getElementById('creditScore').value),
                        debtToIncome: 30, // Default value
                        employment: 5, // Default value
                        downPayment: 20 // Default value
                    }
                };
                
                // Display results
                displayPrediction(prediction);
                displayRiskFactors(prediction);
                
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                // Reset button
                btnText.classList.remove('hidden');
                btnSpinner.classList.add('hidden');
                btn.disabled = false;
            }
        });

        function displayPrediction(prediction) {
            const resultDiv = document.getElementById('predictionResult');
            const contentDiv = document.getElementById('predictionContent');
            
            const statusClass = prediction.approved ? 'prediction-approved' : 'prediction-rejected';
            const statusIcon = prediction.approved ? '‚úÖ' : '‚ùå';
            const statusText = prediction.approved ? 'APPROVED' : 'REJECTED';
            
            contentDiv.innerHTML = `
                <div class="${statusClass} text-white p-6 rounded-xl mb-4 text-center">
                    <div class="text-4xl mb-2">${statusIcon}</div>
                    <div class="text-2xl font-bold">${statusText}</div>
                    <div class="text-lg opacity-90">Confidence: ${prediction.confidence}%</div>
                </div>
                
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between">
                        <span>Model Score:</span>
                        <span class="font-medium">${prediction.score}/100</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Debt-to-Income Ratio:</span>
                        <span class="font-medium">${(prediction.debtToIncomeRatio * 100).toFixed(1)}%</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Loan-to-Value Ratio:</span>
                        <span class="font-medium">${(prediction.loanToValueRatio * 100).toFixed(1)}%</span>
                    </div>
                </div>
            `;
            
            resultDiv.classList.remove('hidden');
            resultDiv.classList.add('fade-in');
        }

        function displayRiskFactors(prediction) {
            const riskDiv = document.getElementById('riskFactors');
            const riskContent = document.getElementById('riskContent');
            
            let riskFactors = [];
            
            if (prediction.factors.creditScore < 650) {
                riskFactors.push({ text: 'Low credit score', severity: 'high' });
            }
            if (prediction.factors.debtToIncome > 36) {
                riskFactors.push({ text: 'High debt-to-income ratio', severity: 'high' });
            }
            if (prediction.factors.employment < 2) {
                riskFactors.push({ text: 'Limited employment history', severity: 'medium' });
            }
            if (prediction.factors.downPayment < 20) {
                riskFactors.push({ text: 'Low down payment', severity: 'medium' });
            }
            
            if (riskFactors.length === 0) {
                riskFactors.push({ text: 'Strong financial profile', severity: 'low' });
            }
            
            const riskHTML = riskFactors.map(factor => {
                const colorClass = factor.severity === 'high' ? 'text-red-600 bg-red-50' : 
                                 factor.severity === 'medium' ? 'text-yellow-600 bg-yellow-50' : 
                                 'text-green-600 bg-green-50';
                
                return `<div class="flex items-center p-3 rounded-lg ${colorClass}">
                    <span class="w-2 h-2 rounded-full bg-current mr-3"></span>
                    ${factor.text}
                </div>`;
            }).join('');
            
            riskContent.innerHTML = riskHTML;
            riskDiv.classList.remove('hidden');
            riskDiv.classList.add('fade-in');
        }

        // Sample data loader (commented out since sampleDataBtn doesn't exist)
        // document.getElementById('sampleDataBtn').addEventListener('click', function() {
        //     document.getElementById('income').value = '85000';
        //     document.getElementById('loanAmount').value = '320000';
        //     document.getElementById('creditScore').value = '740';
        //     document.getElementById('employmentYears').value = '6';
        //     document.getElementById('monthlyDebt').value = '1800';
        //     document.getElementById('downPayment').value = '64000';
        //     document.getElementById('propertyType').value = 'single-family';
        //     document.getElementById('firstTimeBuyer').checked = false;
        //     document.getElementById('selfEmployed').checked = false;
        // });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97d0905591a444b9',t:'MTc1NzUyNDQ4OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

